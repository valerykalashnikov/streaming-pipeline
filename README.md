# streaming-pipeline

The actual implementation of a streaming files pipeline explained [here](https://github.com/valerykalashnikov/streaming-pipeline/blob/master/design/Design.md#worker-pool-with-message-queue)

## Repository structure
The repository is a monorepo with a source code of the services located in the `./cmd` directory.It contains of
  - [file emitter service](#file-emitter-service)
  - [publisher service](#publisher-service)
  - [consumer service](#consumer-service)

Design documents are located in the `design` folder.
  
Compiled binaries are located in `./bin`

## How to run all unit tests
`make test-unit`

## How to run an environment
`make env-start`

## File emitter service
Command line service to generate a file randomly in a range from some megabytes to some gigabytes. The format of the record in a file is "123 12345".

### How to build
`make build-fileemitter`

And the binary will be put into the `./bin` directory

### How to run
`./bin/file-emitter`

### Comand line options
| Parsed argments | Resulting value | Defaults         | Description|
| -----------     | -----------     |----------        |-------------|
| --min-size=10MB | 10MB            | 2MB              | Min size of the file            |
| --max-size=3GB  | 3GB             | 10MB             | Max size of the size            |
| --out=/tmp/files| /tmp/files      | /tmp/fileemitter | The name of the directory to locate generated files            |

## Publisher service
The service processing the files generated by file-emitter service. It parses file, handle states not to process files twice and publishes row onto queue to be handled by consumer service

### How to build
`make build-publisher`

And the binary will be put into the `./bin` directory

### How to run
Run `make env-start` if it was not running before.
Then run `./bin/publisher`

### Comand line options
| Parsed argments | Resulting value | Defaults         |Description|
| -----------     | -----------     |----------        |-----------|
| --force-scan    | true            | false            |Uses to delete state and scan from the begining. Use on your own risk!!!|
| -d              | true            | false            |Daemonize the process to scan the folder once an hour|
| --out=/tmp/files| /tmp/files      | /tmp/fileemitter |Directory path to process files|


## Consumer service